<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Google Maps</title>

<script src="http://maps.google.com/maps?file=api&amp;v=2.93&amp;key={$gmap_key}"
      type="text/javascript"></script>
{literal}


 </head>

  <body onunload="GUnload()">


    <!-- you can use tables or divs for the overall layout -->

           <div id="map" style="float:left; width: 87%; height:600px;"></div>
 <div id="side_bar" style="float:right; width:12%; height:600px; overflow:auto; margin:1px;"></div>
    
<noscript><b>JavaScript must be enabled in order for you to use Google Maps.</b> 
      However, it seems JavaScript is either disabled or not supported by your browser. 
      To view Google Maps, enable JavaScript by changing your browser options, and then 
      try again.
    </noscript>
 

    <script type="text/javascript">
    //<![CDATA[

    if (GBrowserIsCompatible()) { 

      // Display the map, with some controls and set the initial location 
      var map = new GMap2(document.getElementById("map"));
      map.addControl(new GLargeMapControl());
      map.addControl(new GMapTypeControl());
      {/literal}
 
      map.setCenter(new GLatLng({$gmap_lat}, {$gmap_long}), 11);
     {literal}
      map.enableScrollWheelZoom();
   
        var iconUP = new GIcon();
        iconUP.image = "modules/gmap/img/green-dot.png";
        iconUP.iconSize = new GSize(15, 15);
        iconUP.iconAnchor = new GPoint(8, 7)
        iconUP.infoWindowAnchor = new GPoint(5, 1);

        var iconWARN = new GIcon();
        iconWARN.image = "modules/gmap/img/yellow-dot.png";
        iconWARN.iconSize = new GSize(15, 15);
        iconWARN.iconAnchor = new GPoint(8, 7)
        iconWARN.infoWindowAnchor = new GPoint(5, 1);

        // Here we set the red/down icon
        var iconDOWN = new GIcon();
        iconDOWN.image = "modules/gmap/img/red-dot.png";
        iconDOWN.iconSize = new GSize(15, 15);
        iconDOWN.iconAnchor = new GPoint(8, 7);
        iconDOWN.infoWindowAnchor = new GPoint(5, 1);

 
      var side_bar_html = "";
      var gmarkers = [];
      var htmls = [];
      var i = 0;
	
     
     
       
      // A function to create the marker and set up the event window
      function createMarker(point,name,popup,location_status) {
	if(location_status == "DOWN") {
       		var marker = new GMarker(point,iconDOWN);
	}
        if (location_status == "WARN") {
		var marker = new GMarker(point,iconWARN);
	}
  	if (location_status == "UP") {
		var marker = new GMarker(point,iconUP);
	}
        GEvent.addListener(marker, "click", function() {
          marker.openInfoWindowHtml(popup);
        });
        // save the info we need to use later for the side_bar
        gmarkers[i] = marker;
        htmls[i] = popup;
        // add a line to the side_bar html
        side_bar_html += '<a href="javascript:myclick(' + i + ')">' + name + '<\/a><br>';
        i++;
        return marker;
      }


      
      function myclick(i) {
        gmarkers[i].openInfoWindowHtml(htmls[i]);
      }
      
      var request = GXmlHttp.create();
      request.open("GET", "modules/gmap/xml.php", true);
      request.onreadystatechange = function() {
        if (request.readyState == 4) {
          var xmlDoc = GXml.parse(request.responseText);
          
          var location = xmlDoc.documentElement.getElementsByTagName("location");
          
          for (var i = 0; i < location.length; i++) {
            // obtain the attribues of each marker
            var lat = parseFloat(location[i].getAttribute("lat"));
            var lng = parseFloat(location[i].getAttribute("lng"));
            var point = new GLatLng(lat,lng);
	    var name = location[i].getAttribute("name");
	    var location_status = location[i].getAttribute("location_status");
            var popup = location[i].getAttribute("popup");
	    //var hosts = location[i].childnodes;
	    var hosts = location[i].childNodes[0].nodeValue;
	    // create the marker
            var marker = createMarker(point,name,hosts,location_status);
            map.addOverlay(marker);
          }
          
          document.getElementById("side_bar").innerHTML = side_bar_html;
          
         
        }
      }
      request.send(null);

    }
    


    //]]>
    </script>
  </body>

</html>
{/literal}

